{% extends 'base.html' %}
{% block title %}autoCN自动化接口平台-首頁{% endblock %}
{% load staticfiles %}
{% block menu %}
    <li><a href="/">首页</a></li>
    <li><a href="/dashboard/">中古车看板</a></li>
    <li class="active"><a href="/newCarDashboard">新车看板<span class="sr-only">(current)</span></a></li>
    <li><a href="/runCase/">执行测试</a></li>
    <li><a href="/failReason/">失败分析</a></li>
{% endblock %}
{% block content %}
    <h1 class="page-header">新车看板</h1>
    <div class="text-right" style="height: auto; width: auto">
        <button type="button" class="btn btn-primary">失败原因汇总数据</button>
        <button type="button" class="btn btn-success">获取最新数据</button>
        <button type="button" class="btn btn-info" onclick="location='/runCase/'">执行测试</button>
    </div>

    <div class="row" id="tab1" style="height: auto; width: auto">

        <div style="height: 410px;min-height: 100px;width:50%;margin: 0 auto" id="mychartmain" class="col-md-6">
            <script type="text/javascript">
                var mychart = echarts.init(document.getElementById("mychartmain"))
                option = {
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [{
                        data: [820, 932, 901, 934, 1290, 1330, 1320],
                        type: 'line',
                        areaStyle: {}
                    }]
                };
                mychart.showLoading();
                var rate = [];
                var id = []
                $.ajax({
                    type: "get",
                    async: true,
                    url: "/returnRate/newCar",
                    data: {},
                    dataType: "json",
                    success: function (result) {
                        if (result != null && result.length > 0) {
                            for (var i = 0; i < result.length; i++) {
                                rate.push(result[i].rate);
                                id.push(result[i].id);
                            }
                            mychart.hideLoading();
                            mychart.setOption({
                                title: {
                                    text: '接口测试通过率'
                                },
                                legend: {
                                    data: ['通过率']
                                },
                                xAxis: {
                                    data: id
                                },
                                yAxis: [
                                    {
                                        type: 'value',
                                        axisLabel: {
                                            show: true,
                                            interval: 'auto',
                                            formatter: '{value} %'
                                        },
                                        show: true
                                    }
                                ],
                                series: [{
                                    name: '通过率',
                                    data: rate,
                                    type: 'line',
                                    color: '#8cd5a9',
                                    areaStyle: {},
                                }
                                    {#                                    {#}
                                    {#                                        name: '达标线',#}
                                    {#                                        type: 'line',#}
                                    {#                                        data: [95],#}
                                    {#                                        markLine: {#}
                                    {#                                            data: [#}
                                    {#                                                {type: 'average', name: '达标线'}#}
                                    {#                                            ]#}
                                    {#                                        }#}
                                    {#                                    }#}
                                ],
                                dataZoom: [
                                    {   // 这个dataZoom组件，默认控制x轴。
                                        type: 'slider', // 这个 dataZoom 组件是 slider 型 dataZoom 组件
                                        start: 60,      // 左边在 10% 的位置。
                                        end: 100         // 右边在 60% 的位置。
                                    }
                                ],
                                label: {
                                    show: true,
                                    interval: 'auto',
                                    rotate: 0,
                                    formatter: '{c} %',
                                    textStyle: {
                                        color: '#333'
                                    }
                                },
                                toolbox: {
                                    show: true,
                                    orient: 'horizontal',
                                    feature: {
                                        dataZoom: {
                                            yAxisIndex: 'none'
                                        },
                                        magicType: {type: ['line', 'bar']},
                                        restore: {},
                                        saveAsImage: {}
                                    }
                                },

                            })
                        }

                    }
                })


                mychart.setOption(option);
            </script>
        </div>


        <div class="table-responsive col-md-6" style="height: 410px;min-height: 100px;width:50%;margin: 0 auto">
            {#                <h2 class="sub-header" style="width:50%;margin: 0 auto" >Section title</h2>#}
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>CI ID</th>
                    <th>测试执行时间</th>
                    <th>通过率</th>
                    <th>执行用例数</th>
                    <th>通过用例数</th>
                    <th>报告详情</th>
                    <th>失败原因</th>
                </tr>
                </thead>
                <tbody>
                {% for result in resultList %}
                    <tr>
                        <td>{{ result.id }}</td>
                        <td>{{ result.start_datetime }}</td>
                        <td>{{ result.rate }}%</td>
                        <td>{{ result.runCaseNum }}</td>
                        <td>{{ result.successCaseNum }}</td>
                        <td><a href="#">详情</a></td>

                        <td>
                            {% if result.rate == 100 %}
                                <button type="button" class="btn btn-success" disabled="disabled">✔ 达标</button>
                            {% elif result.isnotes == 1 %}
                                <button type="button" class="btn btn-success" disabled="disabled">✔已填写</button>
                            {% else %}
                                <button type="button" class="btn btn-warning" data-toggle="modal"
                                        data-target="#myAddNotesModal{{ result.id }}">未填写
                                </button>
                                <div class="modal fade" id="myAddNotesModal{{ result.id }}" tabindex="-1" role="dialog"
                                     aria-labelledby="myAddNotesModal" aria-hidden="true">
                                    <div class="modal-dialog"
                                         style="height: 500px;min-height: 500px;width:500px;">
                                        <div class="modal-content">
                                            <form id="form-addNotes" method="POST"
                                                  style="align-content: center">
                                                {% csrf_token %}
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal"
                                                            aria-hidden="true">&times;</button>
                                                    <h4 class="modal-title" id="myAddNotesModal">請添加Notes內容</h4>
                                                </div>
                                                <label for="name"
                                                       style="margin-left: 5%;margin-top: 2%;width: 90%">选择列表</label>
                                                <select id="notesCategoryID{{ result.id }}" class="form-control"
                                                        style="margin-left: 5%;margin-top: 2%;width: 90%">
                                                    {% for category in notesCategory %}
                                                        <option>{{ category }}</option>
                                                    {% endfor %}
                                                </select>
                                                <textarea id="notesID{{ result.id }}" name="notes"
                                                          class="modal-body text-left"
                                                          style="margin-left: 5%;margin-top: 2%;width: 90%"></textarea>
                                                <!-- <div class="modal-body">在这里添加一些文本</div> -->
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">
                                                        关闭
                                                    </button>
                                                    <!-- <button type="button" class="btn btn-primary" type="submit">提交更改</button>-->
                                                    <!--<input type="submit" value="提交更改" class="btn btn-primary">-->
                                                    <input type="button" value="提交更改" class="btn btn-primary"
                                                           onclick="addNotes({{ result.id }})">

                                                </div>
                                            </form>
                                        </div><!-- /.modal-content -->
                                    </div><!-- /.modal -->
                                </div>
                            {% endif %}
                        </td>

                    </tr>
                {% endfor %}
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <hr>

{% endblock %}
